<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anthropic AI: Data Operations Workflow Automation Strategy</title>
    
    <!-- Prism CSS for code highlighting (if needed) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />

    <!-- MathJax Configuration (if needed for formulas) -->
    <script>
        MathJax = {
          chtml: {
            fontURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2'
          }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" id="MathJax-script" async></script>

    <!-- Viz.js Libraries for Graphviz -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/full.render.js"></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            border-radius: 8px;
        }
        header {
            background-color: #4A5C6A; /* Anthropic-like or professional color */
            color: #fff;
            padding: 25px 30px;
            border-radius: 8px 8px 0 0;
            text-align: center;
        }
        header h1 {
            margin: 0;
            font-size: 2.2em;
            font-weight: 600;
        }
        header p {
            margin: 5px 0 0;
            font-size: 1.1em;
        }
        nav {
            background-color: #f1f1f1;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        nav ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
            text-align: center;
        }
        nav ul li {
            display: inline-block;
            margin: 0 15px;
        }
        nav ul li a {
            text-decoration: none;
            color: #337ab7;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }
        nav ul li a:hover, nav ul li a.active {
            background-color: #ddd;
            color: #23527c;
        }
        h2 {
            color: #4A5C6A;
            border-bottom: 2px solid #4A5C6A;
            padding-bottom: 10px;
            margin-top: 30px;
            font-size: 1.8em;
        }
        h3 {
            color: #5A7284;
            font-size: 1.4em;
            margin-top: 25px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        ul, ol {
            margin-left: 20px;
        }
        li {
            margin-bottom: 8px;
        }
        strong {
            color: #333;
        }
        .kpi-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .kpi-table th, .kpi-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        .kpi-table th {
            background-color: #e9ecef;
            font-weight: 600;
        }
        .graph-container {
            width: 100%;
            overflow: auto; /* Allows horizontal scrolling if graph is too wide */
            border: 1px solid #ccc;
            border-radius: 6px;
            padding: 15px;
            box-sizing: border-box;
            margin-top: 20px;
            background-color: #fdfdfd;
        }
        #graph-output {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #graph-output svg {
            max-width: 100%; /* Responsive SVG */
            height: auto;
            cursor: grab; /* Indicate interactivity */
        }
        #graph-output svg:active {
            cursor: grabbing;
        }
        .error-message {
            color: #D8000C;
            background-color: #FFD2D2;
            border: 1px solid #D8000C;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        .button-group {
            margin-top: 10px;
            margin-bottom: 10px;
        }
        .button-group button {
            padding: 8px 15px;
            margin-right: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .button-group button:hover {
            background-color: #0056b3;
        }

        /* Accordion styles for collapsible sections */
        .accordion {
            background-color: #f9f9f9;
            color: #444;
            cursor: pointer;
            padding: 18px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 1.2em;
            transition: 0.4s;
            border-radius: 4px;
            margin-top: 10px;
            border-bottom: 1px solid #ddd;
        }
        .accordion.active, .accordion:hover {
            background-color: #e0e0e0;
        }
        .accordion:after {
            content: '\\002B'; /* Unicode character for "plus" sign (+) */
            font-size: 1.1em;
            color: #777;
            float: right;
            margin-left: 5px;
        }
        .accordion.active:after {
            content: "\\2212"; /* Unicode character for "minus" sign (-) */
        }
        .panel {
            padding: 0 18px;
            background-color: white;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            border-left: 1px solid #ddd;
            border-right: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
            border-radius: 0 0 4px 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Project Blueprint: Automating Anthropic's Data Operations</h1>
            <p>A Strategic Approach to Enhance Quality, Efficiency, and Scalability for Pre-train and Post-train Data</p>
        </header>

        <nav>
            <ul>
                <li><a href="#introduction" class="active">Introduction</a></li>
                <li><a href="#workflow-diagram">Workflow Diagram</a></li>
                <li><a href="#phased-approach">Phased Approach</a></li>
                <li><a href="#enablers">Key Enablers</a></li>
                <li><a href="#kpis">KPIs</a></li>
                <li><a href="#conclusion">Conclusion</a></li>
            </ul>
        </nav>

        <section id="introduction" class="section">
            <h2>Executive Summary & Strategic Imperative</h2>
            <p>To maintain and enhance its competitive positioning against industry leaders like Google (Gemini), OpenAI, and xAI (Grok), Anthropic must evolve its data operations for pre-training and post-training data. The current reliance on external vendors for annotated data, while common, presents opportunities for significant optimization through automation and streamlined lifecycle management. This proposal outlines a phased approach to build a robust, scalable, and quality-driven data pipeline. The core objective is to transform data operations from a reactive, manual process into a proactive, automated, and continuously improving system.</p>
            <p>This transformation will yield benefits in:
                <ul>
                    <li><strong>Data Quality:</strong> Higher consistency and accuracy of training data.</li>
                    <li><strong>Operational Efficiency:</strong> Reduced manual effort and faster turnaround times.</li>
                    <li><strong>Scalability:</strong> Ability to handle increasing volumes and complexity of data.</li>
                    <li><strong>Cost Optimization:</strong> Lower costs associated with data procurement and review.</li>
                    <li><strong>Vendor Performance Management:</strong> Objective and actionable feedback to data vendors.</li>
                    <li><strong>Competitive Agility:</strong> Faster iteration on models due to quicker access to high-quality data.</li>
                </ul>
            </p>
        </section>

        <section id="workflow-diagram" class="section">
            <h2>Proposed Automated Data Operations Workflow</h2>
            <p>The following diagram illustrates the envisioned end-to-end automated data operations workflow. This system integrates data procurement, multi-stage automated QA, human-in-the-loop review, and a continuous feedback mechanism with vendors, ensuring a virtuous cycle of data quality improvement.</p>
            
            <div class="graph-container">
                <div id="graph-output">
                    <p>Loading workflow diagram...</p>
                </div>
            </div>
            <div class="button-group" id="zoom-controls" style="display:none; text-align:center;">
                <button id="zoom-in">Zoom In (+)</button>
                <button id="zoom-out">Zoom Out (-)</button>
                <button id="reset-zoom">Reset Zoom</button>
            </div>
            <p style="text-align:center; font-size:0.9em; color:#666;">Use mouse wheel or pinch-to-zoom on the diagram for magnification. You can also drag to pan.</p>
        </section>

        <section id="phased-approach" class="section">
            <h2>Phased Implementation Approach</h2>
            <p>We recommend a phased approach to implement this automated workflow, allowing for iterative development, learning, and risk mitigation.</p>

            <button class="accordion">Phase 1: Foundational Infrastructure & Procurement Automation</button>
            <div class="panel">
                <h3>Objectives:</h3>
                <ul>
                    <li>Establish a centralized system for vendor interaction and data submission.</li>
                    <li>Automate initial data ingestion, validation, and basic quality checks.</li>
                </ul>
                <h3>Key Components & Activities:</h3>
                <ul>
                    <li><strong>Vendor Management Portal:</strong>
                        <ul>
                            <li>Secure portal for vendor onboarding, project assignment, and data submission.</li>
                            <li>Standardized submission guidelines and templates.</li>
                            <li>Communication channel for clarifications and announcements.</li>
                        </ul>
                    </li>
                    <li><strong>Standardized Data Ingestion Pipeline:</strong>
                        <ul>
                            <li>APIs and batch upload capabilities for various data formats (JSON, CSV, text, etc.).</li>
                            <li>Automated data parsing and transformation into a canonical internal format.</li>
                            <li>Version control for all ingested data.</li>
                        </ul>
                    </li>
                    <li><strong>Initial Automated QA (AutoQA V1):</strong>
                        <ul>
                            <li><strong>Format & Schema Validation:</strong> Ensure data conforms to predefined structures.</li>
                            <li><strong>Basic Content Checks:</strong> Detect PII (configurable rules), profanity, character limits, empty fields.</li>
                            <li><strong>Duplicate Detection:</strong> Identify duplicate entries within a batch or against historical data.</li>
                            <li>Automated rejection/flagging of data failing these basic checks.</li>
                        </ul>
                    </li>
                </ul>
                <h3>Expected Outcomes:</h3>
                <ul>
                    <li>Reduced manual effort in data intake and basic validation.</li>
                    <li>Early detection of fundamental data quality issues.</li>
                    <li>Consistent data formatting for downstream processes.</li>
                </ul>
            </div>

            <button class="accordion">Phase 2: Advanced AutoQA & Human-in-the-Loop (HITL) Integration</button>
            <div class="panel">
                <h3>Objectives:</h3>
                <ul>
                    <li>Implement sophisticated AI-driven QA checks.</li>
                    <li>Integrate an efficient human review platform for tasks requiring nuanced judgment.</li>
                    <li>Optimize human review effort through intelligent sampling.</li>
                </ul>
                <h3>Key Components & Activities:</h3>
                <ul>
                    <li><strong>AI-Powered AutoQA (AutoQA V2):</strong>
                        <ul>
                            <li><strong>Semantic Consistency Checks:</strong> E.g., ensuring answers are relevant to questions.</li>
                            <li><strong>Bias Detection:</strong> Identify potential demographic, social, or cognitive biases (requires careful model training and ethical considerations).</li>
                            <li><strong>Factuality & Groundedness Checks (where applicable):</strong> Cross-referencing with knowledge bases or provided context.</li>
                            <li><strong>Style & Tone Consistency:</strong> Ensure data adheres to specified stylistic guidelines.</li>
                            <li><strong>Complexity & Readability Scores:</strong> Assess if data meets desired complexity levels.</li>
                        </ul>
                    </li>
                    <li><strong>Intelligent Sampling for Human Review:</strong>
                        <ul>
                            <li>Risk-based sampling: Prioritize data with higher uncertainty scores from AutoQA.</li>
                            <li>Diversity-focused sampling: Ensure coverage across various data characteristics.</li>
                            <li>Random sampling for ongoing quality monitoring.</li>
                            <li>Adaptive sampling based on vendor performance and past quality trends.</li>
                        </ul>
                    </li>
                    <li><strong>Integrated Human Review Platform:</strong>
                        <ul>
                            <li>User-friendly interface for annotation, review, and adjudication.</li>
                            <li>Workflow management for assigning tasks, tracking progress, and managing reviewer consensus.</li>
                            <li>Integration with "gold standard" datasets or honeypots for reviewer calibration and performance monitoring.</li>
                            <li>Tools for efficient feedback and issue flagging by reviewers.</li>
                            <li>Ability to escalate complex cases or ambiguities.</li>
                        </ul>
                    </li>
                </ul>
                <h3>Expected Outcomes:</h3>
                <ul>
                    <li>Significant improvement in detecting subtle data quality issues.</li>
                    <li>Optimized allocation of human review resources to highest-impact areas.</li>
                    <li>Higher overall quality of data feeding into model training.</li>
                </ul>
            </div>

            <button class="accordion">Phase 3: Vendor Feedback & Continuous Improvement Loop</button>
            <div class="panel">
                <h3>Objectives:</h3>
                <ul>
                    <li>Establish a systematic and automated process for providing feedback to data vendors.</li>
                    <li>Enable a continuous improvement cycle for data quality from vendors.</li>
                    <li>Ensure comprehensive data lineage and traceability.</li>
                </ul>
                <h3>Key Components & Activities:</h3>
                <ul>
                    <li><strong>Automated Vendor Reporting & Scorecards:</strong>
                        <ul>
                            <li>Dashboards displaying vendor performance metrics (e.g., pass rates, common error types, timeliness).</li>
                            <li>Automated generation of quality reports for each submitted batch, highlighting specific issues.</li>
                            <li>Benchmarking vendor performance.</li>
                        </ul>
                    </li>
                    <li><strong>Closed-Loop Feedback Mechanism:</strong>
                        <ul>
                            <li>Direct integration of QA findings (both automated and human review) into the Vendor Management Portal.</li>
                            <li>Clear communication channels for discussing quality issues and remediation plans.</li>
                            <li>Tracking of vendor responses and improvements over time.</li>
                        </ul>
                    </li>
                    <li><strong>Data Lineage & Traceability:</strong>
                        <ul>
                            <li>End-to-end tracking of each data point: source, transformations, QA results, reviewer actions, and final usage.</li>
                            <li>Ability to trace back model performance issues to specific data batches or sources.</li>
                            <li>Support for data auditing and compliance requirements.</li>
                        </ul>
                    </li>
                    <li><strong>Approved & Enriched Data Lake:</strong>
                        <ul>
                            <li>Central repository for all high-quality, processed, and versioned data.</li>
                            <li>Rich metadata associated with each data asset.</li>
                            <li>Searchable and queryable interface for data scientists and ML engineers.</li>
                        </ul>
                    </li>
                </ul>
                <h3>Expected Outcomes:</h3>
                <ul>
                    <li>Improved vendor accountability and data quality over time.</li>
                    <li>Faster resolution of data quality issues.</li>
                    <li>Enhanced trust and transparency in the data pipeline.</li>
                    <li>Valuable insights for future data procurement strategies.</li>
                </ul>
            </div>
            
            <button class="accordion">Phase 4: Advanced Analytics & Proactive Optimization</button>
            <div class="panel">
                <h3>Objectives:</h3>
                <ul>
                    <li>Leverage data pipeline analytics for proactive quality management and process optimization.</li>
                    <li>Develop predictive capabilities to anticipate and mitigate data quality risks.</li>
                    <li>Continuously refine and adapt the QA system.</li>
                </ul>
                <h3>Key Components & Activities:</h3>
                <ul>
                    <li><strong>Comprehensive Performance Dashboards:</strong>
                        <ul>
                            <li>Real-time monitoring of key metrics: data throughput, overall quality scores, cost per data unit, human review efficiency, AutoQA model performance.</li>
                            <li>Trend analysis and anomaly detection.</li>
                        </ul>
                    </li>
                    <li><strong>Predictive Quality Models:</strong>
                        <ul>
                            <li>ML models to predict the likelihood of a data batch failing quality checks based on initial characteristics or vendor history.</li>
                            <li>Proactive alerting and intervention for high-risk data.</li>
                        </ul>
                    </li>
                    <li><strong>Self-Learning QA System:</strong>
                        <ul>
                            <li>Continuously update and retrain AutoQA models based on human review feedback and model performance impact.</li>
                            <li>Adaptive thresholds and rules for AutoQA.</li>
                        </ul>
                    </li>
                    <li><strong>Root Cause Analysis Tools:</strong>
                        <ul>
                            <li>Tools to investigate and identify the root causes of recurring data quality problems.</li>
                            <li>Link data quality issues back to specific vendor practices, task instructions, or ambiguities in requirements.</li>
                        </ul>
                    </li>
                     <li><strong>Insights from Model Performance:</strong>
                        <ul>
                            <li>Feedback loop from model training and evaluation stages to identify data gaps, biases amplified by models, or types of data that particularly improve/degrade performance.</li>
                            <li>Use these insights to refine data procurement strategies, annotation guidelines, and QA priorities.</li>
                        </ul>
                    </li>
                </ul>
                <h3>Expected Outcomes:</h3>
                <ul>
                    <li>Data operations shift from reactive to proactive and predictive.</li>
                    <li>Continuous optimization of resource allocation and cost-effectiveness.</li>
                    <li>A highly adaptive and resilient data pipeline that supports cutting-edge model development.</li>
                </ul>
            </div>
        </section>

        <section id="enablers" class="section">
            <h2>Key Enablers for Success</h2>
            <p>Successfully implementing this automated workflow requires focus on several key enablers:</p>
            <ul>
                <li><strong>Technology Stack:</strong>
                    <ul>
                        <li><strong>Workflow Orchestration:</strong> Tools like Apache Airflow, Kubeflow Pipelines, or a cloud-native step function service.</li>
                        <li><strong>Data Storage & Processing:</strong> Cloud storage (e.g., S3, GCS), data lakes (e.g., Delta Lake, Iceberg), and distributed processing frameworks (e.g., Spark).</li>
                        <li><strong>ML for AutoQA:</strong> Leverage existing Anthropic models or build specialized QA models using frameworks like TensorFlow/PyTorch. MLOps platforms for managing these models.</li>
                        <li><strong>Human Review Platform:</strong> Build or buy. Options range from custom-built solutions to integrating with platforms like Labelbox, Scale AI, or open-source alternatives like Label Studio.</li>
                        <li><strong>Business Intelligence & Reporting:</strong> Tools like Tableau, Power BI, Looker, or custom dashboards.</li>
                    </ul>
                </li>
                <li><strong>Cross-Functional Collaboration:</strong> Close collaboration between Data Operations, ML Research, Engineering, and Product teams.</li>
                <li><strong>Change Management & Training:</strong> Comprehensive training for internal teams and vendors on new processes and tools. Clear communication about the benefits and impact of automation.</li>
                <li><strong>Robust Governance & Data Security:</strong>
                    <ul>
                        <li>Clear data governance policies, including data ownership, access control, and privacy.</li>
                        <li>Secure handling of sensitive data throughout the pipeline.</li>
                        <li>Compliance with relevant data protection regulations.</li>
                    </ul>
                </li>
                <li><strong>Iterative Development & Feedback:</strong> Adopt an agile methodology, continuously gathering feedback and refining the system.</li>
                <li><strong>Talent & Expertise:</strong> Ensure access to skilled personnel in data engineering, ML, software development, and UX design (for review tools).</li>
            </ul>
        </section>

        <section id="kpis" class="section">
            <h2>Measuring Success: Key Performance Indicators (KPIs)</h2>
            <p>The success of this initiative will be measured by a set of quantifiable KPIs:</p>
            <table class="kpi-table">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>KPI</th>
                        <th>Description</th>
                        <th>Target/Goal</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan_3>Quality</td>
                        <td>Data Acceptance Rate (Post-AutoQA)</td>
                        <td>Percentage of data passing all automated QA checks.</td>
                        <td>Increase by X%</td>
                    </tr>
                    <tr>
                        <td>Human Review Accuracy</td>
                        <td>Agreement rate between human reviewers and gold standards/adjudication.</td>
                        <td>>Y%</td>
                    </tr>
                    <tr>
                        <td>Defect Density in Final Data</td>
                        <td>Number of identified errors per N data units in the approved dataset.</td>
                        <td>Decrease by Z%</td>
                    </tr>
                    <tr>
                        <td rowspan_3>Efficiency & Speed</td>
                        <td>End-to-End Data Processing Time</td>
                        <td>Average time from data ingestion to availability for model training.</td>
                        <td>Reduce by A%</td>
                    </tr>
                    <tr>
                        <td>Human Review Throughput</td>
                        <td>Number of data items reviewed per human hour.</td>
                        <td>Increase by B%</td>
                    </tr>
                    <tr>
                        <td>Automation Rate</td>
                        <td>Percentage of QA tasks handled automatically without human intervention.</td>
                        <td>Achieve C%</td>
                    </tr>
                    <tr>
                        <td rowspan_2>Cost</td>
                        <td>Cost Per Quality Data Unit</td>
                        <td>Total cost of data operations divided by the volume of approved, high-quality data.</td>
                        <td>Reduce by D%</td>
                    </tr>
                    <tr>
                        <td>Vendor Cost Optimization</td>
                        <td>Reduction in costs due to improved vendor quality and less rework.</td>
                        <td>Save $E annually</td>
                    </tr>
                     <tr>
                        <td rowspan_2>Vendor Performance</td>
                        <td>Vendor Quality Score</td>
                        <td>Composite score based on submission quality, timeliness, and responsiveness.</td>
                        <td>Improve average score to F</td>
                    </tr>
                    <tr>
                        <td>Vendor Rework Rate</td>
                        <td>Percentage of data requiring rework or rejection from vendors.</td>
                        <td>Reduce to < G%</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section id="conclusion" class="section">
            <h2>Conclusion & Next Steps</h2>
            <p>Automating Anthropic's data operations workflow is a strategic imperative for maintaining a competitive advantage. The proposed phased approach provides a clear roadmap to build a scalable, efficient, and quality-focused data pipeline. This initiative will not only enhance the quality of data used for pre-training and post-training but also free up valuable human resources to focus on more complex and strategic tasks.</p>
            <h3>Recommended Next Steps:</h3>
            <ol>
                <li><strong>Establish a dedicated project team:</strong> Assemble a cross-functional team with representatives from Data Operations, ML Research, Engineering, and Product.</li>
                <li><strong>Detailed requirements gathering for Phase 1:</strong> Conduct workshops to finalize detailed requirements for the Vendor Management Portal and Initial AutoQA components.</li>
                <li><strong>Technology evaluation and selection:</strong> Assess and select appropriate technologies for workflow orchestration, data storage, and the initial human review interface (if a stop-gap is needed before full platform development).</li>
                <li><strong>Develop a pilot program for Phase 1:</strong> Select a specific data type or vendor to pilot the initial automated ingestion and QA process.</li>
                <li><strong>Define baseline KPIs:</strong> Measure current performance against the defined KPIs to establish a baseline for tracking progress.</li>
            </ol>
            <p>We are confident that by embarking on this transformation, Anthropic will significantly strengthen its data foundations, enabling the development of even more powerful and reliable AI models.</p>
        </section>

    </div>

    <script>
        // Accordion script
        var acc = document.getElementsByClassName("accordion");
        var i;
        for (i = 0; i < acc.length; i++) {
            acc[i].addEventListener("click", function() {
                this.classList.toggle("active");
                var panel = this.nextElementSibling;
                if (panel.style.maxHeight) {
                    panel.style.maxHeight = null;
                } else {
                    panel.style.maxHeight = panel.scrollHeight + "px";
                } 
            });
        }

        // Smooth scrolling for nav links
        document.querySelectorAll('nav a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
                this.classList.add('active');
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                     // Calculate position with offset for fixed header if any (not in this design, but good practice)
                    const headerOffset = 0; // Adjust if you have a fixed header
                    const elementPosition = targetElement.getBoundingClientRect().top;
                    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

                    window.scrollTo({
                        top: offsetPosition,
                        behavior: "smooth"
                    });
                }
            });
        });
        
        // Update active nav link on scroll
        window.addEventListener('scroll', () => {
            let current = '';
            const sections = document.querySelectorAll('.section');
            const navLinks = document.querySelectorAll('nav a');
            const headerOffset = 100; // Adjust this value based on your header or other fixed elements

            sections.forEach(section => {
                const sectionTop = section.offsetTop - headerOffset;
                if (pageYOffset >= sectionTop) {
                    current = '#' + section.getAttribute('id');
                }
            });

            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === current) {
                    link.classList.add('active');
                }
            });
            // If no section is "current" (e.g., at the very top or bottom out of section range), default to first if appropriate
            if (!current && navLinks.length > 0) {
                 // Check if at top of page, if so, set first link active
                if (pageYOffset < sections[0].offsetTop - headerOffset) {
                    navLinks[0].classList.add('active');
                }
            }
        });


        // Graphviz Rendering
        document.addEventListener('DOMContentLoaded', async () => {
            const dotString = `
            digraph AnthropicDataWorkflow {
                rankdir="LR";
                graph [bgcolor="transparent", fontname="Arial", fontsize=12, pad="0.5"];
                node [shape=box, style="filled,rounded", fontname="Arial", fontsize=10, margin="0.15,0.1"];
                edge [fontname="Arial", fontsize=9, color="#555555"];

                // Subgraphs for clarity
                subgraph cluster_procurement {
                    label="Phase 1: Procurement & Initial QA";
                    labeljust="l";
                    bgcolor="#E6F2FF"; 
                    node [fillcolor="#B3D9FF"];

                    VendorData [label="Vendor Data\n(Diverse Sources & Formats)", shape=cylinder, fillcolor="#AED6F1"];
                    DataIngestion [label="Standardized Data Ingestion\n(API, Batch Uploads)"];
                    FormatSchemaValidation [label="Format & Schema Validation\n(Automated)", fillcolor="#A2D5F2"];
                    BasicContentChecks [label="Basic Content Checks\n(PII, Profanity, Length)", fillcolor="#A2D5F2"];
                }

                subgraph cluster_advanced_qa_review {
                    label="Phase 2: Advanced QA & Human Review";
                    labeljust="l";
                    bgcolor="#E6FFE6"; 
                    node [fillcolor="#B3FFB3"];

                    AIPoweredQA [label="AI-Powered AutoQA\n(Semantic, Bias, Consistency,\nRelevance, Factuality)", fillcolor="#A2F2A2", width=2.5];
                    IntelligentSampling [label="Intelligent Sampling\n(Risk-based, Diversity-focused,\nConfidence Scores)", shape=diamond, fillcolor="#FAD7A0", width=2.5];
                    HumanReviewPlatform [label="Human Review & Annotation Platform\n(Targeted Review, Adjudication, Feedback Tools)", width=3];
                    GoldStandardSets [label="Gold Standard / Honeypots\n(Calibrate Reviewers, Test QA)", shape=septagon, fillcolor="#F9E79F"];
                }

                subgraph cluster_feedback_storage {
                    label="Phase 3: Feedback & Data Storage";
                    labeljust="l";
                    bgcolor="#FFF2E6"; 
                    node [fillcolor="#FFD9B3"];

                    VendorFeedbackPortal [label="Vendor Feedback Portal\n(Quality Reports, Rejection Reasons,\nPerformance Scorecards)"];
                    DataQualityDashboard [label="Data Quality Dashboard\n(Real-time Metrics, Trends)", shape=note, fillcolor="#FDEBD0", width=2];
                    ApprovedDataLake [label="Approved & Enriched Data Lake\n(Versioned, Searchable, Metadata-rich)", shape=cylinder, fillcolor="#AED6F1"];
                }

                subgraph cluster_model_training {
                    label="Phase 4: Model Utilization & Iteration";
                    labeljust="l";
                    bgcolor="#F2E6FF";
                    node [fillcolor="#D9B3FF"]; 

                    PretrainData [label="Pre-training Data Pool"];
                    PosttrainData [label="Post-training Data Pool\n(SFT, RLHF, DPO etc.)"];
                    ModelTraining [label="Anthropic Model Training\n(Pre-train / Fine-tune / RL)", shape=component, fillcolor="#CBAACB"];
                    ModelEvaluation [label="Model Performance Evaluation\n(Quantitative & Qualitative)", shape=parallelogram, fillcolor="#CBAACB"];
                    TrainingDataInsights [label="Insights from Model Performance\n(Data Gaps, Bias Amplification,\nEffective Data Characteristics)"];
                }

                // Connections
                VendorData -> DataIngestion [label="Procurement"];
                DataIngestion -> FormatSchemaValidation [label="Ingest"];
                FormatSchemaValidation -> BasicContentChecks [label="Validate"];
                BasicContentChecks -> AIPoweredQA [label="Initial Pass"];
                AIPoweredQA -> IntelligentSampling [label="Quality Score\n& Confidence"];

                IntelligentSampling -> HumanReviewPlatform [label="Sample for Review\n(Low Confidence / High Impact)"];
                AIPoweredQA -> ApprovedDataLake [label="Direct Approval\n(High Confidence)", taillabel="    ", headlabel="    "]; // Add space to avoid overlap
                GoldStandardSets -> HumanReviewPlatform [label="Calibration\nBlind Tests", style=dashed, color="#007bff"];
                HumanReviewPlatform -> ApprovedDataLake [label="Reviewed &\nApproved Data"];
                HumanReviewPlatform -> VendorFeedbackPortal [label="Reviewer Feedback\n(Quality Issues)"];
                AIPoweredQA -> VendorFeedbackPortal [label="AutoQA Feedback\n(Systematic Errors)"];

                VendorFeedbackPortal -> VendorData [style=dashed, label="Iterative Improvement\nFeedback to Vendor", dir=back, constraint=false, color="#D35400"];

                ApprovedDataLake -> PretrainData;
                ApprovedDataLake -> PosttrainData;
                PretrainData -> ModelTraining;
                PosttrainData -> ModelTraining;
                ModelTraining -> ModelEvaluation;
                ModelEvaluation -> TrainingDataInsights [label="Feedback Loop"];
                
                TrainingDataInsights -> AIPoweredQA [style=dashed, label="Refine AutoQA Rules\nUpdate Models", constraint=false, color="#27AE60"];
                TrainingDataInsights -> IntelligentSampling [style=dashed, label="Adjust Sampling Strategy", constraint=false, color="#27AE60"];
                TrainingDataInsights -> DataIngestion [style=dashed, label="Guide Future\nData Procurement", constraint=false, color="#27AE60"];
                TrainingDataInsights -> HumanReviewPlatform [style=dashed, label="Update Reviewer\nGuidelines", constraint=false, color="#27AE60"];


                // Global elements linked to dashboards
                FormatSchemaValidation -> DataQualityDashboard [style=dotted, color="#3498DB", constraint=false];
                BasicContentChecks -> DataQualityDashboard [style=dotted, color="#3498DB", constraint=false];
                AIPoweredQA -> DataQualityDashboard [style=dotted, color="#3498DB", constraint=false];
                HumanReviewPlatform -> DataQualityDashboard [style=dotted, color="#3498DB", constraint=false];
                ModelEvaluation -> DataQualityDashboard [style=dotted, color="#3498DB", constraint=false];
            }
            `;

            const graphContainer = document.getElementById('graph-output');
            const zoomControls = document.getElementById('zoom-controls');

            if (!graphContainer) {
                console.error("Error: Container 'graph-output' not found.");
                return;
            }

            if (typeof Viz === 'undefined') {
                 const errorMsg = 'Error: Viz.js library not loaded. Cannot render graph.';
                 console.error(errorMsg);
                 graphContainer.innerHTML = `<p class="error-message">${errorMsg}</p>`;
                 return;
            }

            try {
                const viz = new Viz();
                const svgElement = await viz.renderSVGElement(dotString);
                
                graphContainer.innerHTML = ''; // Clear loading message
                graphContainer.appendChild(svgElement);
                zoomControls.style.display = 'block'; // Show zoom controls

                // Basic Pan and Zoom functionality
                let scale = 1;
                const svg = graphContainer.querySelector('svg');
                const panSpeed = 2; 
                let isPanning = false;
                let startPoint = {x: 0, y: 0};
                let viewBox = {x: 0, y: 0, width: svg.viewBox.baseVal.width, height: svg.viewBox.baseVal.height};
                svg.setAttribute('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.width} ${viewBox.height}`);


                svg.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    const zoomFactor = 0.1;
                    const delta = e.deltaY > 0 ? 1 + zoomFactor : 1 - zoomFactor;
                    
                    const newWidth = viewBox.width * delta;
                    const newHeight = viewBox.height * delta;

                    // Calculate new x and y to zoom towards mouse pointer
                    const CTM = svg.getScreenCTM();
                    const mouseX = (e.clientX - CTM.e) / CTM.a;
                    const mouseY = (e.clientY - CTM.f) / CTM.d;
                    
                    viewBox.x = mouseX - (mouseX - viewBox.x) * delta;
                    viewBox.y = mouseY - (mouseY - viewBox.y) * delta;
                    viewBox.width = newWidth;
                    viewBox.height = newHeight;
                    
                    svg.setAttribute('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.width} ${viewBox.height}`);
                });

                svg.addEventListener('mousedown', (e) => {
                    isPanning = true;
                    startPoint = {x: e.clientX, y: e.clientY};
                    svg.style.cursor = 'grabbing';
                });

                svg.addEventListener('mousemove', (e) => {
                    if (!isPanning) return;
                    e.preventDefault();
                    const CTM = svg.getScreenCTM();
                    const dx = (startPoint.x - e.clientX) / CTM.a;
                    const dy = (startPoint.y - e.clientY) / CTM.d;
                    
                    viewBox.x += dx;
                    viewBox.y += dy;
                    svg.setAttribute('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.width} ${viewBox.height}`);
                    startPoint = {x: e.clientX, y: e.clientY};
                });

                svg.addEventListener('mouseup', () => {
                    isPanning = false;
                    svg.style.cursor = 'grab';
                });
                svg.addEventListener('mouseleave', () => { // Stop panning if mouse leaves SVG
                    isPanning = false;
                    svg.style.cursor = 'grab';
                });
                
                // Zoom buttons
                const originalViewBox = { ...viewBox }; // Store initial viewBox for reset

                document.getElementById('zoom-in').addEventListener('click', () => {
                    const zoomFactor = 0.8; // zoom in means smaller viewBox area relative to content
                    viewBox.x += viewBox.width * (1 - zoomFactor) / 2;
                    viewBox.y += viewBox.height * (1 - zoomFactor) / 2;
                    viewBox.width *= zoomFactor;
                    viewBox.height *= zoomFactor;
                    svg.setAttribute('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.width} ${viewBox.height}`);
                });

                document.getElementById('zoom-out').addEventListener('click', () => {
                    const zoomFactor = 1.25; // zoom out means larger viewBox area
                    viewBox.x -= viewBox.width * (zoomFactor - 1) / 2;
                    viewBox.y -= viewBox.height * (zoomFactor - 1) / 2;
                    viewBox.width *= zoomFactor;
                    viewBox.height *= zoomFactor;
                    svg.setAttribute('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.width} ${viewBox.height}`);
                });
                 document.getElementById('reset-zoom').addEventListener('click', () => {
                    viewBox = { ...originalViewBox };
                    svg.setAttribute('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.width} ${viewBox.height}`);
                });


            } catch (error) {
                const errorMsg = `Graphviz rendering failed: ${error.message || error}`;
                console.error("Graphviz rendering error:", error);
                graphContainer.innerHTML = `<p class="error-message">${errorMsg}</p>`;
            }
        });
    </script>
    
    <!-- Prism JS for code highlighting (if needed) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <!-- Add other languages if needed: prism-python, prism-yaml etc. -->

</body>
</html>
